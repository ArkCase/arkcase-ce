- name: create {{ s.schema }} database (empty schema)
  become: yes
  mysql_db:
    login_unix_socket: /opt/data/mariadb/mysql.sock
    name: "{{ s.schema }}"
    encoding: utf8
    state: present
  when: s.script | length == 0
- name: create {{ s.schema }} database (with schema)
  become: yes
  mysql_db:
    login_unix_socket: /opt/data/mariadb/mysql.sock
    name: "{{ s.schema }}"
    encoding: utf8
    state: import
    target: "/opt/install/pentaho/{{ s.script }}"
    single_transaction: yes
  when: s.script | length > 0
  
- name: create {{ s.user }} MySQL user
  become: yes
  mysql_user:
    login_unix_socket: /opt/data/mariadb/mysql.sock
    host: "%"
    name: "{{ s.user }}"
    password: "{{ default_database_password }}" 
    priv: '*.*:REQUIRESSL/{{ s.schema }}.*:ALL'
    state: present 
- name: create {{ s.user }} MySQL user (IP address)
  become: yes
  mysql_user:
    login_unix_socket: /opt/data/mariadb/mysql.sock
    host: "192.168.56.15"
    name: "{{ s.user }}"
    password: "{{ default_database_password }}" 
    priv: '*.*:REQUIRESSL/{{ s.schema }}.*:ALL'
    state: present 
- name: create {{ s.user }} MySQL user (host name)
  become: yes
  mysql_user:
    login_unix_socket: /opt/data/mariadb/mysql.sock
    host: "arkcase-ce.local"
    name: "{{ s.user }}"
    password: "{{ default_database_password }}" 
    priv: '*.*:REQUIRESSL/{{ s.schema }}.*:ALL'
    state: present 
    

  
