- name: create {{ item }} MariaDB database and user
  block:
    - name: create {{ item }} database
      become: yes
      mysql_db:
        ca_cert: "{{ root_folder }}/common/rds-ca-2019-root.pem"
        login_host: "{{ database_host_name }}"
        login_user: "{{ rds_user | default('arkcase_root') }}"
        login_password: "{{ rds_password }}"
        name: "{{ item }}"
        encoding: utf8
        state: present
    - name: create {{ item }} MySQL user
      become: yes
      mysql_user:
        ca_cert: "{{ root_folder }}/common/rds-ca-2019-root.pem"
        login_host: "{{ database_host_name }}"
        login_user: "{{ rds_user | default('arkcase_root') }}"
        login_password: "{{ rds_password }}"
        host: "%"
        name: "{{ item }}"
        password: "{{ default_database_password }}" 
        state: present 
    - name: grant privileges to {{ item }}
      become: yes
      command: mysql -u{{ rds_user | default('arkcase_root') }} -p'{{ rds_password }}' -h {{ database_host_name }} -Ns -e "grant select, insert, update, delete, create, drop, index, alter, lock tables, create view, trigger on {{ item }}.* to '{{ item }}'@'%'"
      changed_when: false
