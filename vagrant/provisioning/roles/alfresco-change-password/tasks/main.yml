- name: set alfresco port, if necessary
  set_fact:
    alfresco_port: 7070
  when: alfresco_port is not defined

- name: set alfresco protocol, if necessary
  set_fact:
    alfresco_protocol: "https"
  when: alfresco_protocol is not defined

- name: set alfresco URL
  set_fact:
    alfresco_url: "{{ alfresco_protocol }}://{{ alfresco_host }}:{{ alfresco_port }}"

- name: change alfresco admin password
  uri:
    url: "{{ alfresco_url }}/alfresco/s/api/person/changepassword/admin"
    method: POST
    user: admin
    password: "{{ old_alfresco_admin_password | default('admin') }}"
    validate_certs: no
    return_content: yes
    body_format: json
    body:
      oldpw: "{{ old_alfresco_admin_password | default('admin') }}"
      newpw: "{{ alfresco_admin_password }}"
  register: change_password_out
  when: old_alfresco_admin_password is defined

- name: results
  debug:
    msg: "{{ change_password_out.content }}"
 
