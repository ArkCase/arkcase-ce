###################################################
# Get the analytical reports project and unzip it
###################################################

- name: Set reports version formatted
  set_fact:
    foia_analytical_reports_version_formatted: "{{ '-' ~ foia_analytical_reports_version if foia_analytical_reports_version != '' else '' }}"
    

- name: create install folder
  become: yes
  become_user: pentaho
  file:
    path: "{{ root_folder }}/install/pentaho/foia-reports-dw{{ foia_analytical_reports_version_formatted }}"
    state: directory  

- name: download FOIA analytical reports repository
  become: yes
  become_user: pentaho
  command: sshpass -e sftp -o StrictHostKeyChecking\=no -o UserKnownHostsFile\=/dev/null {{ sftp_arkcase_user }}@{{ sftp_service_base_url }}:{{ sftp_arkcase_folder }}/{{ item }}
  args:
    chdir: "{{ root_folder }}/install/pentaho"
  environment:
    SSHPASS: "{{ sftp_arkcase_password }}"
  loop:
    - foia-reports-dw{{ foia_analytical_reports_version_formatted }}.zip

- set_fact:
  md5_value: "{{ lookup('file', '/{{ root_folder }}/install/pentaho/pentaho.md5') }}"

- get_url:
    url: 

