- name: deploy arkcase-api-gateway
  include_tasks: "{{ role_path }}/../arkcase-microservice/tasks/deploy_microservice.yml"
  vars:
    microservice:
      name: arkcase-api-gateway
      version: "{{ arkcase_api_gateway_version | default(arkcase_version) }}"
      java_opts: "-Dserver.port=9002 -Dmanagement.server.port=9002 -Xmx512M -Dspring.config.import=configserver:https://{{ config_server_host | default(internal_host) }}/config -Dspring.profiles.include={{ arkcase_portal_extension ~ ',' if arkcase_portal_extension != '' else '' }}server,runtime -Djava.net.preferIPv4Stack=true -Djavax.net.ssl.trustStorePassword={{ java_trust_store_pass }} -Djavax.net.ssl.keyStore={{ java_p12_store_jdk8 }} -Djavax.net.ssl.trustStore={{ java_trust_store}} -Djavax.net.ssl.keyStorePassword={{ java_key_store_pass }} -Dspring.kafka.bootstrap-servers={{ kafka_host | default(internal_host) }}:{{ kafka_port | default(9092) }} -Darkcase.kafka.bootstrapAddress={{ kafka_host | default(internal_host) }}:{{ kafka_port | default(9092) }} -Dspring.kafka.producer.bootstrap-servers={{ kafka_host | default(internal_host) }}:{{ kafka_port | default(9092) }} -Dspring.kafka.security.protocol=SSL -Deureka.client.securePortEnabled=true -Deureka.client.serviceUrl.defaultZone=https://{{ internal_host }}:8761/eureka"
      boot_opts: "--spring.config.location=classpath:/application.yaml,{{ root_folder }}/app/arkcase-api-gateway/server.yml"
      template: server.yml
