- name: Ensure group alfresco7 exists
  become: yes
  group:
    name: alfresco7
    state: present

- name: alfresco7 user
  become: yes
  user:
    name: alfresco7
    shell: /bin/false
    state: present
    group: alfresco7

- name: set path to alfresco data folder
  set_fact:
    data_folder: "{{ alfresco_data_folder | default(root_folder + '/data/alfresco7') }}"

- name: alfresco7 folders
  become: yes
  file:
    path: "{{ item }}"
    state: directory
    group: alfresco7
    owner: alfresco7
  loop:
    - "{{ root_folder }}/log/alfresco7"
    - "{{ root_folder }}/app/alfresco7"    
    - "{{ root_folder }}/app/alfresco7/alfresco7-pdf-renderer"
    - "{{ root_folder }}/install/alfresco7"
    - "{{ root_folder }}/tmp/alfresco7"
    - "{{ data_folder }}"
    - "{{ data_folder }}/alf_data"
  register: alfresco7_folder_structure

- name: link data folder to root folder if necessary
  become: yes
  file:
    group: alfresco7
    owner: alfresco7
    src: "{{ data_folder }}"
    dest: "{{ root_folder }}/data/alfresco7"
    state: link
  when: data_folder != root_folder + "/data/alfresco7"

- name: enable logrotate for alfresco7 log folder if necessary
  include_tasks: "{{ role_path }}/../common/tasks/logrotate.yml"
  loop:
    - alfresco7

