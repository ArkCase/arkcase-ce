- name: remove the decrypted symmetric key
  become: yes
  file:
    path: "{{ root_folder }}/common/symmetricKey.decrypted"
    state: absent

- name: start config server
  become: yes
  systemd:
    daemon_reload: true
    name: "config-server"
    state: started

- name: wait for config server
  wait_for:
    connect_timeout: 15
    delay: 5
    port: 9999

- name: start arkcase
  become: yes
  systemd:
    daemon_reload: true
    name: "arkcase"
    state: started

- name: wait for ArkCase URL to work
  uri:
    url: https://{{ internal_host }}:8843/arkcase/
    validate_certs: false
    follow_redirects: all
  register: _result
  until: _result.status == 200
  retries: 100
  delay: 5

- name: fapolicy settings for ArkCase, if fapolicyd is installed
  include_tasks: "{{ role_path }}/../fapolicyd/tasks/main.yml"
  loop:
    - name: arkcase_app
      folder_path: "{{ root_folder }}/app/arkcase"
    - name: arkcase_ui
      folder_path: "{{ root_folder }}/data/arkcase-home/.arkcase/custom"
    - name: arkcase_tmp
      folder_path: "{{ root_folder }}/data/arkcase-home/.arkcase/tmp"

