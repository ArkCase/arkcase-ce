- name: ensure Solr is stopped
  become: yes
  systemd:
    name: solr
    state: stopped

- name: ensure Alfresco is stopped
  become: yes
  systemd:
    name: alfresco
    state: stopped

- name: ensure Snowbound is stopped
  become: yes
  systemd:
    name: snowbound
    state: stopped    
    
- name: backup data folders 
  become: yes
  file:
    path: "{{ root_folder }}/backups/data"
    state: present

- name: Solr data backuping
  become: yes
  copy:
    src: "{{ root_folder }}/data/solr"
    dest: "{{ root_folder }}/backups/data/solr-{{ ansible_date_time.iso8601 }}"
    directory_mode: yes
    owner: solr
    group: solr
    backup: yes

- name: Alfresco data backuping
  become: yes
  copy:
    src: "{{ root_folder }}/data/alfresco"
    dest: "{{ root_folder }}/backups/data/alfresco-{{ ansible_date_time.iso8601 }}"
    directory_mode: yes
    owner: alfresco
    group: alfresco
    backup: yes

- name: Snowbound docs backuping
  become: yes
  copy:
    src: "{{ root_folder }}/data/snowbound/snowbound-docs"
    dest: "{{ root_folder }}/backups/data/snowbound-docs-{{ ansible_date_time.iso8601 }}"
    directory_mode: yes
    owner: snowbound
    group: snowbound
    backup: yes

- name: External-portal-api files backuping
  become: yes
  copy:
    src: "{{ root_folder }}/data/arkcase-home/.external-portal-api/files"
    dest: "{{ root_folder }}/backups/data/external-portal-api-files-{{ ansible_date_time.iso8601 }}"
    directory_mode: yes
    owner: arkcase
    group: arkcase
    backup: yes
  when: foia_portal_context is defined

- name: External-portal http context backuping
  become: yes
  copy:
    src: "{{ root_folder }}/data/httpd/htdocs/foia"
    dest: "{{ root_folder }}/backups/data/external-portal-httpd-context-{{ ansible_date_time.iso8601 }}"
    directory_mode: yes
    owner: arkcase
    group: arkcase
    backup: yes
  when: foia_portal_context is defined  
