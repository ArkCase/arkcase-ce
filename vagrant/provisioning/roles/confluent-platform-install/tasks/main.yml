---
# tasks file for confluent-install
- name: Install curl and which
  yum:
    name: "{{ packages }}"
  vars:
    packages:
    - curl
    - which

- name: Install Confluent Platform public key
  rpm_key:
    state: present
    key: https://packages.confluent.io/rpm/{{ confluent_major_version }}/archive.key

- name: Create Confluent repo (1/2)
  yum_repository:
    name: Confluent.dist
    description: Confluent repository (dist)
    baseurl: https://packages.confluent.io/rpm/{{ confluent_major_version }}/{{ confluent_minor_version }}
    gpgcheck: yes
    gpgkey: https://packages.confluent.io/rpm/{{ confluent_major_version }}/archive.key
    enabled: yes
    file: confluent

- name: Create Confluent repo (2/2)
  yum_repository:
    name: Confluent
    description: Confluent repository
    baseurl: https://packages.confluent.io/rpm/{{ confluent_major_version }}
    gpgcheck: yes
    gpgkey: https://packages.confluent.io/rpm/{{ confluent_major_version }}/archive.key
    enabled: yes
    file: confluent

# The yum module does not support clearing yum cache in an idempotent way!
- name: Clean the yum caches
  command: yum clean all
  args:
    warn: False

- name: Install Confluent Platform
  yum:
    name: confluent-platform-{{ confluent_scala_version }}
    state: present
  
